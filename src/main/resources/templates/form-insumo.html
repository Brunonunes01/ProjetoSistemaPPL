<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">

<section layout:fragment="content">

    <div class="row">
        <div class="col-md-8 col-lg-6 mx-auto">
            <div class="card shadow-sm">
                <div class="card-header">
                    <h1 class="h4 mb-0" th:text="${titulo}"></h1>
                </div>
                <div class="card-body">
                    <form th:action="@{/insumos/salvar}" method="post" th:object="${insumo}">

                        <input type="hidden" th:field="*{id}"/>

                        <div class="mb-3">
                            <label for="nome" class="form-label">Nome do Insumo:</label>
                            <input type="text" id="nome" class="form-control" th:field="*{nome}"
                                   placeholder="Ex: Produto Limpador X"/>
                        </div>

                        <div class="mb-3">
                            <label for="unidadeDeMedida" class="form-label">Unidade de Medida:</label>
                            <select id="unidadeDeMedida" class="form-select" th:field="*{unidadeDeMedida}">
                                <option value="">Selecione a unidade...</option>
                                <option th:each="unidade : ${unidades}"
                                        th:value="${unidade}"
                                        th:text="${unidade}">Litro
                                </option>
                            </select>
                        </div>

                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label for="precoRecipiente" class="form-label" id="labelPreco">Pre√ßo do Recipiente (R$):</label>
                                <input type="number" id="precoRecipiente" class="form-control" th:field="*{precoRecipiente}"
                                       step="0.01" min="0" placeholder="Ex: 130.00"/>
                            </div>
                            <div class="col-md-6">
                                <label for="quantidadeRecipiente" class="form-label" id="labelQtd">Qtd. no Recipiente:</label>
                                <input type="number" id="quantidadeRecipiente" class="form-control" th:field="*{quantidadeRecipiente}"
                                       step="0.001" min="0" placeholder="Ex: 5"/>
                            </div>
                        </div>

                        <hr>

                        <div class="d-flex justify-content-between">
                            <button type="submit" class="btn btn-success">Salvar Insumo</button>
                            <a href="/insumos" class="btn btn-secondary">Voltar para Lista</a>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const selectUnidade = document.getElementById('unidadeDeMedida');
            const labelPreco = document.getElementById('labelPreco');
            const labelQtd = document.getElementById('labelQtd');
            const inputQtd = document.getElementById('quantidadeRecipiente');

            // üí° AQUI EST√Å A CORRE√á√ÉO: Lista completa de unidades unit√°rias
            const unidadesUnitarias = ['Hora', 'Minuto', 'kWh', 'Unidade(s)', 'km'];

            function atualizarFormulario() {
                const unidadeSelecionada = selectUnidade.value;

                if (unidadesUnitarias.includes(unidadeSelecionada)) {
                    // Limpa o "(s)" ou "(metro c√∫bico)" para o r√≥tulo ficar bonito
                    const unidadeLimpa = unidadeSelecionada.split(' ')[0].replace('(s)', '');

                    labelPreco.textContent = `Custo por ${unidadeLimpa} (R$):`;
                    labelQtd.textContent = `Quantidade de ${unidadeLimpa}s:`;

                    inputQtd.value = '1';
                    inputQtd.readOnly = true;
                    inputQtd.style.backgroundColor = '#e9ecef';
                } else {
                    // Caso padr√£o (Litro, kg, ml, g, m¬≥)
                    labelPreco.textContent = 'Pre√ßo do Recipiente (R$):';
                    labelQtd.textContent = 'Qtd. no Recipiente:';

                    inputQtd.readOnly = false;
                    inputQtd.style.backgroundColor = '#fff';

                    const idInput = document.querySelector('input[name="id"]');
                    if (!idInput || !idInput.value) {
                         if (inputQtd.value === '1') {
                            inputQtd.value = '';
                         }
                    }
                }
            }

            atualizarFormulario();
            selectUnidade.addEventListener('change', atualizarFormulario);
        });
    </script>
</section>
</html>